<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OCTODON SYSTEM v16.0 - TACTICAL MONITOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Black+Ops+One&display=swap');
        
        body { 
            background-color: #050505; 
            color: #e2e8f0; 
            font-family: 'JetBrains Mono', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 16px;
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }

        .cyber-font { font-family: 'Black Ops One', cursive; letter-spacing: 0.1em; }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .status-box { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #1e293b; }
        
        /* çŠ¶æ…‹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
        .status-red { 
            background: linear-gradient(135deg, rgba(69,10,10,0.8) 0%, rgba(0,0,0,0.9) 100%);
            border-color: #ef4444; 
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
            animation: pulse-red 2s infinite;
        }
        .status-yellow { 
            background: linear-gradient(135deg, rgba(66,32,6,0.8) 0%, rgba(0,0,0,0.9) 100%);
            border-color: #eab308; 
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.3);
        }
        .status-green { 
            background: linear-gradient(135deg, rgba(20,83,45,0.8) 0%, rgba(0,0,0,0.9) 100%);
            border-color: #22c55e; 
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* UIãƒ‘ãƒ¼ãƒ„ */
        .scan-btn {
            background: linear-gradient(90deg, #4f46e5 0%, #3730a3 100%);
            position: relative; overflow: hidden;
        }
        .scan-btn:active { transform: scale(0.98); }
        .scan-btn::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .scan-btn:hover::after { left: 100%; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* ã‚¿ãƒ¼ãƒŸãƒŠãƒ«é¢¨å‡ºåŠ›ã‚¨ãƒªã‚¢ */
        .terminal-window {
            background-color: #0f172a;
            border: 1px solid #334155;
            box-shadow: inset 0 0 20px #020617;
            position: relative;
        }
    </style>
</head>
<body class="space-y-3"> 
    <header class="flex justify-between items-end pb-2 border-b border-slate-800">
        <div>
            <div class="flex items-center gap-2 mb-1">
                <span onclick="resetApiKey()" class="text-[10px] text-slate-600 hover:text-red-500 cursor-pointer font-bold tracking-widest">[RESET KEY]</span>
                <span id="model-badge" class="text-[9px] bg-slate-900 border border-slate-700 px-1.5 py-0.5 rounded text-slate-500">SYSTEM OFFLINE</span>
                
                <button onclick="copyEmergencyScript()" class="text-[9px] bg-red-950 border border-red-700 text-red-400 hover:bg-red-900 hover:text-white px-2 py-0.5 rounded transition-colors font-bold tracking-widest flex items-center gap-1 shadow-[0_0_5px_rgba(220,38,38,0.5)]">
                    ğŸ†˜ EMERGENCY COPY
                </button>
            </div>
            <h1 class="text-2xl cyber-font text-white leading-none tracking-tighter">OCTODON <span class="text-indigo-500">SYS.16.1</span></h1> 
        </div>
        <div class="text-right">
            <div class="text-[9px] text-slate-500">JST (TOKYO)</div>
            <div id="clock" class="text-xl font-bold text-slate-400 cyber-font">00:00:00</div> 
        </div>
    </header>

    <div class="grid grid-cols-2 gap-2 h-32 md:h-40">
        <div id="card-macro" class="status-box bg-slate-900 rounded-lg flex flex-col items-center justify-center relative">
            <div class="absolute top-1 left-2 text-[8px] text-slate-500 tracking-widest">SECTOR A</div>
            <button onclick="deepDiveSector('macro')" id="btn-deepdive-macro" class="hidden absolute top-1 right-1 text-xs bg-slate-800 text-indigo-400 border border-indigo-500/50 hover:bg-indigo-500 hover:text-white rounded w-6 h-6 flex items-center justify-center transition-colors shadow-[0_0_5px_rgba(99,102,241,0.5)] z-10" title="COMMANDER DEEP DIVE">ğŸ”</button>
            <div class="text-xl mb-1 flex gap-2">ğŸ¦… âš–ï¸</div>
            <div class="text-xs font-bold text-slate-300 text-center leading-tight">MACRO<br><span class="text-[9px] text-slate-500">NAS / METAL</span></div>
            <div id="status-macro" class="mt-1 text-[9px] px-2 py-0.5 bg-slate-950 rounded text-slate-600">WAITING</div> 
        </div>
        
        <div id="card-deepsea" class="status-box bg-slate-900 rounded-lg flex flex-col items-center justify-center relative">
            <div class="absolute top-1 left-2 text-[8px] text-slate-500 tracking-widest">SECTOR B</div>
            <button onclick="deepDiveSector('deepsea')" id="btn-deepdive-deepsea" class="hidden absolute top-1 right-1 text-xs bg-slate-800 text-indigo-400 border border-indigo-500/50 hover:bg-indigo-500 hover:text-white rounded w-6 h-6 flex items-center justify-center transition-colors shadow-[0_0_5px_rgba(99,102,241,0.5)] z-10" title="COMMANDER DEEP DIVE">ğŸ”</button>
            <div class="text-xl mb-1 flex gap-2">âš“ ğŸ’</div>
            <div class="text-xs font-bold text-slate-300 text-center leading-tight">DEEP SEA<br><span class="text-[9px] text-slate-500">JP / US</span></div>
            <div id="status-deepsea" class="mt-1 text-[9px] px-2 py-0.5 bg-slate-950 rounded text-slate-600">WAITING</div>
        </div>
    </div>
    <button onclick="executeMission()" id="scan-btn" class="scan-btn w-full py-4 text-white font-bold rounded-lg shadow-lg flex items-center justify-center gap-2 transition-all group">
        <span class="text-xl group-hover:rotate-90 transition-transform duration-500">âœœ</span>
        <span id="btn-text" class="text-sm tracking-[0.2em] font-bold">INITIATE SCAN</span> 
        <div id="progress-bar" class="absolute bottom-0 left-0 h-1 bg-cyan-400 w-0 transition-all duration-300"></div>
    </button>
    <div class="flex-grow overflow-hidden flex flex-col mt-3">
        <div class="terminal-window rounded-lg flex-grow flex flex-col overflow-hidden relative">
            <button onclick="downloadReport()" id="download-btn" class="hidden absolute top-2 right-2 z-10 text-[9px] bg-slate-800 text-cyan-400 px-2 py-1 rounded border border-cyan-700 hover:bg-cyan-900 hover:text-white transition-colors flex items-center gap-1">
                <span>â¬‡</span> DOWNLOAD .MD
            </button>

            <div id="system-log" class="p-2 border-b border-slate-700 bg-slate-950 text-[10px] text-green-500 font-mono h-24 overflow-y-auto">
                > SYSTEM READY.<br>
                > AWAITING COMMAND...<br>
            </div>
            
            <div class="flex-grow overflow-y-auto p-3 text-xs leading-relaxed text-slate-300 whitespace-pre-wrap font-mono no-scrollbar" id="report-content">
(ã“ã“ã«æˆ¦æ³å ±å‘ŠãŒã‚»ã‚¯ã‚¿ãƒ¼ã”ã¨ã«é€æ¬¡è¡¨ç¤ºã•ã‚Œã¾ã™)
            </div>
        </div>
    </div>
    <script>
        // --- è¨­å®šå¤‰æ•° ---
        let apiKey = localStorage.getItem("octdon_api_key");
        
        let SCOUT_MODEL = "gemini-2.5-flash"; 
        let COMMANDER_MODEL = "gemini-3-flash-preview"; 
        const sectorDataStore = {};
        const TARGET_MACRO = "US Stock Index Futures (NQ, ES), Nikkei 225 Futures (OSE, SGX, CME), Nikkei 225 Mini, Gold/Oil Futures, VIX Index, Options Implied Volatility, Put/Call Ratio,USD/JPY Exchange Rate";
        const TARGET_DEEP_SEA = "JP: JMDC(4483) INPEX(1605) JXé‡‘å±(5016) PTSæ ªä¾¡ ç©ºå£²ã‚Šæ®‹é«˜, US: GOOGL IonQ Pre-market After-hours price, Options Implied Volatility";

        

        // --- åˆæœŸåŒ–å‡¦ç† ---
        async function init() {
            updateClock();
            setInterval(updateClock, 1000);
            if (!apiKey) {
                const input = prompt("OCTODON SYSTEM: APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (AIza...)");
                if (input && input.startsWith("AIza")) {
                    apiKey = input.trim();
                    localStorage.setItem("octdon_api_key", apiKey);
                    log("API KEY SAVED.");
                    detectModels();
                } else log("ERROR: API KEY REQUIRED.");
            } else detectModels();
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('ja-JP');
        }

        function log(msg) {
            const el = document.getElementById('system-log');
            el.innerHTML += `> ${msg}<br>`;
            el.scrollTop = el.scrollHeight;
        }

        function resetApiKey() {
            if(confirm("èªè¨¼æƒ…å ±ã‚’ç ´æ£„ã—ã¾ã™ã‹ï¼Ÿ")) {
                localStorage.removeItem("octdon_api_key");
                location.reload();
            }
        }

        function downloadReport() {
            const content = document.getElementById('report-content').innerText;
            if(!content || content.includes("(ã“ã“ã«æˆ¦æ³å ±å‘Š")) return alert("ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10);
            const timeStr = now.toTimeString().slice(0, 5).replace(':', '-');
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `OCTODON_REPORT_${dateStr}_${timeStr}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- â˜…NEW: ç·Šæ€¥æ‰‹å‹•å®Ÿè¡Œç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ---
        function copyEmergencyScript() {
            const now = new Date();
            const prevDate = new Date(now);
            prevDate.setDate(prevDate.getDate() - 2); 
            const dateStr = prevDate.toISOString().split('T')[0];

            // AIã«ãã®ã¾ã¾æŠ•ã’ã‚‹ãŸã‚ã®è¶…å¼·åŠ›ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå‘½ä»¤æ–‡ï¼‰ãƒ‡ã‚°ï¼
            const promptText = `ä»¥ä¸‹ã®æƒ…å ±ã‚’åé›†ã—ã€æˆ¦æ³å ±å‘Šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

ã€æ¤œç´¢æœŸé–“ã€‘: after:${dateStr} (æœ€æ–°ã®æ•°å€¤ã‚’ç¢ºå®Ÿã«æ‹¾ã†ã“ã¨)

ã€ç›£è¦–å¯¾è±¡ã€‘
1. MACRO: ${TARGET_MACRO} latest price news (Open High Low Close)
2. DEEP SEA (æ·±æµ·ç›£è¦–): ${TARGET_DEEP_SEA} latest price news (Open High Low Close)

ã€åˆ†æã®é‡è¦æŒ‡ä»¤ã€‘
åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€ä»¥ä¸‹ã®4ç‚¹ã‚’ç‰¹ã«å³ã—ãåˆ¤å®šã—ã¦ãã ã•ã„ï¼š
1. ã€Œè¡Œã£ã¦æ¥ã„ï¼ˆå®Ÿä½“ãŒå°ã•ããƒ’ã‚²ãŒé•·ã„ï¼‰ã€ã«ã‚ˆã‚‹æ”»å‹¢å¤±æ•—ã®å…†å€™ã¯ã‚ã‚‹ã‹ï¼Ÿï¼ˆåè½è­¦æˆ’ğŸ”„ï¼‰
2. ä¾¡æ ¼ãŒæ€¥è½ã—ã€ã€Œæ·±æµ·æŒ‡å€¤ï¼ˆãƒ‘ãƒ‹ãƒƒã‚¯å£²ã‚Šæ™‚ã®å¤§åº•ï¼‰ã€ã®ãƒ©ã‚¤ãƒ³ã«åˆ°é”ã—ã¤ã¤ã‚ã‚‹çµ¶å¥½ã®å¾…æ©ŸéŠ˜æŸ„ã¯ã‚ã‚‹ã‹ï¼Ÿï¼ˆè£œçµ¦ãƒãƒ£ãƒ³ã‚¹ğŸ’ï¼‰
3. æ™‚é–“å¤–å–å¼•ï¼ˆPTS/Pre-marketï¼‰ã®æ€¥è½ã‚„ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³IVãƒ»ç©ºå£²ã‚Šæ®‹é«˜ã®ç•°å¸¸å€¤ãŒã‚ã‚‹ã‹ï¼Ÿï¼ˆå±é™ºå¯ŸçŸ¥ğŸ”¥ï¼‰
4. é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ±ºç®—ã€é…å½“æ—¥ã€SQã€æ˜¥ç¯€ãªã©ï¼‰ã‚„äº‹ä»¶ã€äº‹æ•…ã€ç½å®³ãªã©ã«ã‚ˆã‚‹åˆ©ç›Šç¢ºå®šã€é€€é¿ã®å‹•ããŒãªã„ã‹ï¼Ÿ

ã€å‡ºåŠ›ã®çµ¶å¯¾ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»æŒ¨æ‹¶ä¸è¦ã€‚å¿…ãšæ—¥æœ¬èªã§ã€äº‹å®Ÿã¨æ•°å€¤ã‚’æ¥µã‚ã¦ç«¯çš„ã«è¨˜è¿°ã›ã‚ˆã€‚
ãƒ»å‡ºåŠ›ã¯å„ã‚»ã‚¯ã‚¿ãƒ¼ï¼ˆMACRO / DEEP SEAï¼‰ã”ã¨ã«æ•´ç†ã™ã‚‹ã“ã¨ã€‚
ãƒ»éŠ˜æŸ„/æŒ‡æ¨™ã”ã¨ã«ã‚¢ã‚¤ã‚³ãƒ³ [ ğŸ”¥å±é™º / ğŸ’è²·ã„(æ·±æµ·åˆ°é”) / ğŸ”„è¡Œã£ã¦æ¥ã„(åè½è­¦æˆ’) / ğŸŸ¡è† ç€ãƒ»ç¾çŠ¶ç¶­æŒ ]ã‚’å…ˆé ­ã«ä»˜ä¸

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
## ã€SECTOR: MACROã€‘
SECTORã”ã¨ã®ç·æ‹¬ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³
ï¼ˆæ”¹è¡Œï¼‰

[åˆ¤å®šã‚¢ã‚¤ã‚³ãƒ³] [éŠ˜æŸ„å] / [ç¾åœ¨ã®æ ªä¾¡]ï¼ˆæ”¹è¡Œï¼‰
è©³ç´°ãªæƒ…å ±ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã®ææ¡ˆ

            `.trim();

            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å‡¦ç†
            navigator.clipboard.writeText(promptText).then(() => {
                alert("ğŸš¨ ç·Šæ€¥ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ã‚°ï¼\nãã®ã¾ã¾Geminiã‚„ChatGPTã®ç”»é¢ã«ã€Œè²¼ã‚Šä»˜ã‘ï¼ˆCtrl+Vï¼‰ã€ã—ã¦å®Ÿè¡Œã—ã¦ã»ã—ã„ãƒ‡ã‚°ï¼");
                log(">> EMERGENCY SCRIPT COPIED TO CLIPBOARD.");
            }).catch(err => {
                alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ãŸãƒ‡ã‚°ğŸ’¦ ãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨©é™ã‚’ç¢ºèªã—ã¦ã»ã—ã„ãƒ‡ã‚°ï¼");
                log(`>> COPY FAILED: ${err}`);
            });
        }

        // â˜…ä¿®æ­£ï¼šAPIã‹ã‚‰ã€Œ3-flashã€ã‚’æœ€å„ªå…ˆã§æ¢ã—å‡ºã™ã‚ˆã†ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰æ›´ï¼
        async function detectModels() {
            const badge = document.getElementById('model-badge');
            badge.innerText = "CONNECTING...";
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`;
                const res = await fetch(url);
                if (!res.ok) throw new Error("Connection Failed");
                const data = await res.json();
                
                // 3-flashã‚’æœ€å„ªå…ˆã€ãªã‘ã‚Œã°2.5-flash
                const flash = data.models.find(m => m.name.includes("gemini-2.5-flash")) || data.models.find(m => m.name.includes("2.5-flash"));
                
                // ä»Šå›ã¯Proã®ä»£ã‚ã‚Šã«ã€COMMANDERã«ã‚‚è³¢ã„3-flashã‚’å‰²ã‚Šå½“ã¦ã‚‹ãƒ‡ã‚°ï¼
                const pro = data.models.find(m => m.name.includes("gemini-3-flash-preview")) || flash;

                if(flash) SCOUT_MODEL = flash.name.replace("models/", "");
                if(pro) COMMANDER_MODEL = pro.name.replace("models/", "");
                
                badge.innerText = `LINKED: SCOUT & COMMANDER (v3)`;
                badge.className = "text-[9px] bg-indigo-900 border border-indigo-500 px-1.5 py-0.5 rounded text-indigo-300";
                log(`SCOUT UNIT: ${SCOUT_MODEL}`);
                log(`COMMANDER: ${COMMANDER_MODEL}`);
            } catch(e) {
                badge.innerText = "AUTH ERROR";
                badge.className = "text-[9px] bg-red-900 border border-red-500 px-1.5 py-0.5 rounded text-red-300";
                log(`ERROR: ${e.message}`);
            }
        }

        // â˜…ä¿®æ­£ï¼š429ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰5ç§’å¾…æ©Ÿã—ã¦å†ãƒˆãƒ©ã‚¤ã™ã‚‹ã€Œç²˜ã‚Šå¼·ã•ã€ã‚’è¿½åŠ ï¼
        async function callGemini(model, text, useSearch = false, retryCount = 0) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: text }] }] };
            if (useSearch) payload.tools = [{ google_search: {} }];
            
            const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            
            if (!res.ok) {
                if (res.status === 429 && retryCount < 2) {
                    log(`âš ï¸ API 429 LIMIT HIT. COOLING DOWN (5s)...`);
                    await new Promise(r => setTimeout(r, 5000));
                    return callGemini(model, text, useSearch, retryCount + 1); // å†å¸°å‘¼ã³å‡ºã—ã§ãƒªãƒˆãƒ©ã‚¤ï¼
                }
                throw new Error(`API Error ${res.status}`);
            }
            const data = await res.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "No Response";
        }

        async function callGeminiSafe(primaryModel, backupModel, text, useSearch = false) {
            try { return await callGemini(primaryModel, text, useSearch); }
            catch (e) {
                log(`âš ï¸ ${primaryModel} FAILED. REROUTING...`);
                if (backupModel && primaryModel !== backupModel) {
                    await new Promise(r => setTimeout(r, 1500));
                    return await callGemini(backupModel, text, useSearch);
                } else throw e;
            }
        }

        async function executeMission() {
            const btn = document.getElementById('scan-btn');
            const btnText = document.getElementById('btn-text');
            const pBar = document.getElementById('progress-bar');
            const reportContent = document.getElementById('report-content');
            const dlBtn = document.getElementById('download-btn');
            
            if(!apiKey) return alert("API Key not set");

            btn.disabled = true;
            dlBtn.classList.add('hidden');
            reportContent.innerHTML = ""; 
            
            // UIãƒªã‚»ãƒƒãƒˆï¼ˆ4ã¤ã‹ã‚‰2ã¤ã«å¤‰æ›´ï¼‰
            document.querySelectorAll('.status-box').forEach(el => el.className = 'status-box bg-slate-900 rounded-lg flex flex-col items-center justify-center relative'); 
            ['macro', 'deepsea'].forEach(id => {
                document.getElementById(`status-${id}`).innerText = "WAITING...";
                document.getElementById(`btn-deepdive-${id}`).classList.add('hidden');
                document.getElementById(`btn-deepdive-${id}`).innerHTML = "ğŸ”";
                document.getElementById(`btn-deepdive-${id}`).classList.remove('animate-spin');
            });
            
            try {
                const now = new Date();
                const prevDate = new Date(now);
                prevDate.setDate(prevDate.getDate() - 2); 
                const afterStr = `after:${prevDate.toISOString().split('T')[0]}`;

                // â˜…NEW: ã‚¹ã‚­ãƒ£ãƒ³å¯¾è±¡ã‚’2ã¤ã«çµ±åˆï¼ã“ã‚Œã§APIã®æ¶ˆè²»ãŒ1å›ã®ã‚¹ã‚­ãƒ£ãƒ³ã§2RPMã«ãªã‚‹ãƒ‡ã‚°ï¼
                const queries = [
                    { 
                        id: "macro", 
                        title: "MACRO ANALYSIS", 
                        q: `${TARGET_MACRO} latest price news (Open High Low Close) ${afterStr}` 
                    },
                    { 
                        id: "deepsea", 
                        title: "DEEP SEA FORCE ", 
                        q: `${TARGET_DEEP_SEA} stock latest price news (Open High Low Close) ${afterStr}` 
                    }
                ];

                btnText.innerText = "SCANNING SECTORS...";
                
                for (let i = 0; i < queries.length; i++) {
                    const s = queries[i];
                    log(`>> DEPLOYING SCOUT TO SECTOR: ${s.id.toUpperCase()}...`);
                    document.getElementById(`status-${s.id}`).innerText = "SCANNING...";
                    document.getElementById(`card-${s.id}`).classList.add('status-yellow');

                    const scoutPrompt = `
ã€åˆ†æã®é‡è¦æŒ‡ä»¤ã€‘
ä»¥ä¸‹ã®æœ€æ–°æƒ…å ±ã‚’æ¤œç´¢ã—ã€äº‹å®Ÿã¨æ•°å€¤ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚
ä½™è¨ˆãªå‰ç½®ãã¯ä¸è¦ã€‚äº‹å®Ÿã¨æ•°å€¤ã®ã¿ã‚’ç®‡æ¡æ›¸ãã«ã™ã‚‹ã“ã¨ã€‚
åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€ä»¥ä¸‹ã®4ç‚¹ã‚’ç‰¹ã«å³ã—ãåˆ¤å®šã—ã¦ãã ã•ã„ï¼š
1. ã€Œè¡Œã£ã¦æ¥ã„ï¼ˆå®Ÿä½“ãŒå°ã•ããƒ’ã‚²ãŒé•·ã„ï¼‰ã€ã«ã‚ˆã‚‹æ”»å‹¢å¤±æ•—ã®å…†å€™ã¯ã‚ã‚‹ã‹ï¼Ÿï¼ˆåè½è­¦æˆ’ğŸ”„ï¼‰
2. ä¾¡æ ¼ãŒæ€¥è½ã—ã€ã€Œæ·±æµ·æŒ‡å€¤ï¼ˆãƒ‘ãƒ‹ãƒƒã‚¯å£²ã‚Šæ™‚ã®å¤§åº•ï¼‰ã€ã®ãƒ©ã‚¤ãƒ³ã«åˆ°é”ã—ã¤ã¤ã‚ã‚‹çµ¶å¥½ã®å¾…æ©ŸéŠ˜æŸ„ã¯ã‚ã‚‹ã‹ï¼Ÿï¼ˆè£œçµ¦ãƒãƒ£ãƒ³ã‚¹ğŸ’ï¼‰
3. æ™‚é–“å¤–å–å¼•ï¼ˆPTS/Pre-marketï¼‰ã®æ€¥è½ã‚„ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³IVãƒ»ç©ºå£²ã‚Šæ®‹é«˜ã®ç•°å¸¸å€¤ãŒã‚ã‚‹ã‹ï¼Ÿï¼ˆå±é™ºå¯ŸçŸ¥ğŸ”¥ï¼‰
4. é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ±ºç®—ã€é…å½“æ—¥ã€SQã€æ˜¥ç¯€ãªã©ï¼‰ã‚„äº‹ä»¶ã€äº‹æ•…ã€ç½å®³ãªã©ã«ã‚ˆã‚‹åˆ©ç›Šç¢ºå®šã€é€€é¿ã®å‹•ããŒãªã„ã‹ï¼Ÿ

ã€å‡ºåŠ›ã®çµ¶å¯¾ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»æŒ¨æ‹¶ä¸è¦ã€‚å¿…ãšæ—¥æœ¬èªã§ã€äº‹å®Ÿã¨æ•°å€¤ã‚’æ¥µã‚ã¦ç«¯çš„ã«è¨˜è¿°ã›ã‚ˆã€‚
ãƒ»éŠ˜æŸ„/æŒ‡æ¨™ã”ã¨ã«ã‚¢ã‚¤ã‚³ãƒ³ [ ğŸ”¥å±é™º / ğŸ’è²·ã„(æ·±æµ·åˆ°é”) / ğŸ”„è¡Œã£ã¦æ¥ã„(åè½è­¦æˆ’) / ğŸŸ¡è† ç€ãƒ»ç¾çŠ¶ç¶­æŒ ]ã‚’å…ˆé ­ã«ä»˜ä¸

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
## [ç°¡æ½”ãªè¦‹å‡ºã—]
ç·æ‹¬ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³
ï¼ˆæ”¹è¡Œï¼‰
[åˆ¤å®šã‚¢ã‚¤ã‚³ãƒ³] [éŠ˜æŸ„å] / [ç¾åœ¨ã®æ ªä¾¡]ï¼ˆæ”¹è¡Œï¼‰
è©³ç´°ãªæƒ…å ±
â€» ç‰¹è¨˜äº‹é …ãŒå¿…è¦ã¨æ€ã‚ã‚Œã‚‹å ´åˆ
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã®ææ¡ˆ

â– æ¤œç´¢å¯¾è±¡: ${s.q}
`;
                    const scoutReport = await callGeminiSafe(SCOUT_MODEL, SCOUT_MODEL, scoutPrompt, true)
                    sectorDataStore[s.id] = scoutReport;

                    const sectorHtml = `
                        <div id="sector-block-${s.id}" class="mb-4 border-l-2 border-slate-600 pl-3 pb-4 border-b border-slate-800/50">
                            <h3 class="text-cyan-400 font-bold text-[13px] md:text-[14px] mb-2 flex items-center gap-2">
                                <span class="bg-cyan-950 border border-cyan-800 px-1.5 py-0.5 rounded text-[10px] text-cyan-500">SEC.${s.id === 'macro' ? 'A' : 'B'}</span>
                                <span>${s.title}</span>
                            </h3>
                            <div class="mb-3 text-slate-300 text-[11px] md:text-xs leading-relaxed">${scoutReport.replace(/\n/g, '<br>')}</div>
                            <div id="commander-report-${s.id}" class="text-indigo-300 font-bold hidden bg-indigo-950/30 p-2 border-l-2 border-indigo-500 mt-2 text-[11px] md:text-xs"></div>
                        </div>
                    `;
                    reportContent.innerHTML += sectorHtml;
                    reportContent.scrollTop = reportContent.scrollHeight; 

                    document.getElementById(`card-${s.id}`).classList.remove('status-yellow');
                    document.getElementById(`card-${s.id}`).classList.add('status-green');
                    document.getElementById(`status-${s.id}`).innerText = "CLEAR";
                    document.getElementById(`status-${s.id}`).className = "mt-1 text-[9px] px-2 py-0.5 bg-green-600 text-white rounded font-bold";
                    
                    document.getElementById(`btn-deepdive-${s.id}`).classList.remove('hidden');

                    pBar.style.width = `${((i+1) / queries.length) * 100}%`;
                    
                    // å¾…æ©Ÿæ™‚é–“ã¯4ç§’ã®ã¾ã¾ã§OKãƒ‡ã‚°ï¼
                    await new Promise(r => setTimeout(r, 4000)); 
                }

                btnText.innerText = "MISSION COMPLETE";
                log("ALL SECTORS SCANNED.");
                dlBtn.classList.remove('hidden');

            } catch (e) {
                console.error(e);
                log(`FATAL ERROR: ${e.message}`);
                reportContent.innerHTML += `\n\n<span class="text-red-500">SYSTEM FAILURE: ${e.message}</span>`;
            } finally {
                btn.disabled = false;
                setTimeout(() => { pBar.style.width = "0%"; btnText.innerText = "RE-SCAN"; }, 2000);
            }
        }

        async function deepDiveSector(sectorId) {
            const btn = document.getElementById(`btn-deepdive-${sectorId}`);
            const outArea = document.getElementById(`commander-report-${sectorId}`);
            
            btn.disabled = true;
            btn.innerHTML = `âš™ï¸`;
            btn.classList.add('animate-spin');
            
            outArea.classList.remove('hidden');
            outArea.innerHTML = "Commander is analyzing tactical data...";
            log(`>> COMMANDER DEEP DIVE: ${sectorId.toUpperCase()}...`);

            const rawData = sectorDataStore[sectorId];
            const commanderPrompt = `
ã‚ãªãŸã¯è»äº‹AIã€ŒOCTODONã€ã§ã™ã€‚ä»¥ä¸‹ã®åµå¯Ÿéƒ¨éšŠã®å ±å‘Šã‚’åˆ†æã—ã€ã‚ˆã‚Šé«˜åº¦ãªæˆ¦æ³å ±å‘Šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

ã€åˆ†æã®é‡è¦æŒ‡ä»¤ã€‘
åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€ä»¥ä¸‹ã®4ç‚¹ã‚’ç‰¹ã«å³ã—ãåˆ¤å®šã—ã¦ãã ã•ã„ï¼š
1. ã€Œè¡Œã£ã¦æ¥ã„ï¼ˆå®Ÿä½“ãŒå°ã•ããƒ’ã‚²ãŒé•·ã„ï¼‰ã€ã«ã‚ˆã‚‹æ”»å‹¢å¤±æ•—ã®å…†å€™ã¯ã‚ã‚‹ã‹ï¼Ÿï¼ˆåè½è­¦æˆ’ğŸ”„ï¼‰
2. ä¾¡æ ¼ãŒæ€¥è½ã—ã€ã€Œæ·±æµ·æŒ‡å€¤ï¼ˆãƒ‘ãƒ‹ãƒƒã‚¯å£²ã‚Šæ™‚ã®å¤§åº•ï¼‰ã€ã®ãƒ©ã‚¤ãƒ³ã«åˆ°é”ã—ã¤ã¤ã‚ã‚‹çµ¶å¥½ã®å¾…æ©ŸéŠ˜æŸ„ã¯ã‚ã‚‹ã‹ï¼Ÿï¼ˆè£œçµ¦ãƒãƒ£ãƒ³ã‚¹ğŸ’ï¼‰
3. æ™‚é–“å¤–å–å¼•ï¼ˆPTS/Pre-marketï¼‰ã®æ€¥è½ã‚„ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³IVãƒ»ç©ºå£²ã‚Šæ®‹é«˜ã®ç•°å¸¸å€¤ãŒã‚ã‚‹ã‹ï¼Ÿï¼ˆå±é™ºå¯ŸçŸ¥ğŸ”¥ï¼‰
4. é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ±ºç®—ã€SQã€æ˜¥ç¯€ãªã©ï¼‰ã«ã‚ˆã‚‹åˆ©ç›Šç¢ºå®šã€é€€é¿ã®å‹•ããŒãªã„ã‹ï¼Ÿ

ã€å‡ºåŠ›ã®çµ¶å¯¾ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»AIã¨ã—ã¦ã®æŒ¨æ‹¶ã€å‰ç½®ãã€è‡ªå·±ç´¹ä»‹ãªã©ã¯ä¸€åˆ‡ç¦æ­¢ã€‚
ãƒ»è»äº‹é€šä¿¡ã®ã‚ˆã†ã«æ¥µã‚ã¦ç„¡æ©Ÿè³ªã€å†·å¾¹ã€ã‹ã¤ç«¯çš„ã«å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚
ãƒ»å„éŠ˜æŸ„ã®çµè«–ã«ã¯ã€å¿…ãšä»¥ä¸‹ã®ã‚¢ã‚¤ã‚³ãƒ³ã„ãšã‚Œã‹1ã¤ã‚’å…ˆé ­ã«ä»˜ä¸ã™ã‚‹ã“ã¨ã€‚
  [ ğŸ”¥å±é™º / ğŸ’è²·ã„(æ·±æµ·åˆ°é”) / ğŸ”„è¡Œã£ã¦æ¥ã„(åè½è­¦æˆ’) / ğŸŸ¡è† ç€ãƒ»ç¾çŠ¶ç¶­æŒ ]

[éŠ˜æŸ„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ]:
[åˆ¤å®šã‚¢ã‚¤ã‚³ãƒ³] [éŠ˜æŸ„å] / [ç¾åœ¨ã®æ ªä¾¡]
è©³ç´°ãªæƒ…å ±ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã®ææ¡ˆ
* æ¬¡ã®éŠ˜æŸ„ã¨ä¸€è¡Œç©ºã‘ã‚‹

[åµå¯Ÿãƒ‡ãƒ¼ã‚¿]:
${rawData}
`;

            try {
                const analysis = await callGeminiSafe(COMMANDER_MODEL, SCOUT_MODEL, commanderPrompt, false);
                outArea.innerHTML = analysis.replace(/\n/g, '<br>');
                
                btn.classList.remove('animate-spin');
                btn.innerHTML = `âœ…`;
                btn.classList.replace('text-indigo-400', 'text-green-400');
                
                log(`>> ANALYSIS COMPLETE FOR ${sectorId.toUpperCase()}.`);
            } catch(e) {
                outArea.innerHTML = `<span class="text-red-500">ANALYSIS FAILED: ${e.message}</span>`;
                btn.classList.remove('animate-spin');
                btn.innerHTML = `âš ï¸`;
                btn.disabled = false;
            }
        }

        window.onload = init;
    </script>
</body>
</html>
